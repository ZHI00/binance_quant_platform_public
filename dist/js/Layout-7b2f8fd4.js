import{aB as a,r as s,m as t,al as e,z as n,A as l,R as c,J as o,B as i,Q as u,a4 as r,u as d,M as f,P as m,T as v,O as p}from"./vue-vendor-4e581967.js";import{E as y,a as g,b,v as h,r as w,c as _,s as k}from"./element-plus-7a40141c.js";import{_ as x,u as T,a as C}from"./index-b37a5370.js";import"./utils-926e52e0.js";const B={class:"layout-container"},j={class:"header-left"},M={class:"nav-tabs"},z={class:"header-right"},A={key:0,class:"dev-mode-badge"},D={key:1,class:"user-info"},L={class:"user-email"},E={class:"expire-date"},H=["disabled"],I=["disabled"],J=["disabled"],N={key:0,class:"status-banner"},O=x({__name:"Layout",setup(x){const O=a(),P=T(),Q=s(!1);t(async()=>{await P.checkAuth(),(async()=>{try{const a=await C.get("/strategy/status");a.data.success&&(Q.value=a.data.running)}catch(a){}})()});const R=[{path:"/overview",label:"总览"},{path:"/strategy",label:"策略配置"},{path:"/logs",label:"运行日志"}],S=async()=>{try{const a={};P.devMode&&(a["X-Dev-Mode"]="true");const s=await C.post("/strategy/start",{},{headers:a});s.data.success?(Q.value=!0,y.success("策略启动成功")):y.error(s.data.message||"策略启动失败")}catch(a){y.error("启动失败: "+a.message)}},X=async()=>{try{(await C.post("/strategy/stop")).data.success&&(Q.value=!1,y.success("策略已停止"))}catch(a){y.error("停止失败: "+a.message)}},q=async()=>{try{await X(),setTimeout(async()=>{await S()},1e3)}catch(a){y.error("重启失败: "+a.message)}},F=async()=>{try{await g.confirm("确定要终止整个程序吗？这将关闭后端服务和前端界面。","终止程序",{confirmButtonText:"确定终止",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0});const s=y({message:"正在关闭程序...",type:"info",duration:0,icon:b});try{await C.post("/shutdown",{},{timeout:2e3})}catch(a){}s.close(),y.success({message:"程序已终止，页面将在3秒后关闭",duration:3e3}),setTimeout(()=>{window.close(),setTimeout(()=>{document.body.innerHTML='<div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #000; color: #fff; font-size: 24px; font-family: sans-serif;">程序已终止，您可以关闭此页面</div>'},500)},3e3)}catch(a){"cancel"!==a&&"close"!==a&&y.error("终止失败: "+a.message)}},G=async()=>{try{await g.confirm("确定要退出登录吗？","退出登录",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P.logout(),y.success("已退出登录"),O.push("/login")}catch(a){}};return(a,s)=>{const t=e("router-link"),y=e("el-icon"),g=e("el-header"),b=e("router-view"),x=e("el-main"),T=e("el-container");return n(),l("div",B,[c(T,null,{default:o(()=>[c(g,{class:"header"},{default:o(()=>{return[i("div",j,[s[0]||(s[0]=i("div",{class:"logo"},[i("div",{class:"logo-icon"},"₿"),i("span",{class:"logo-text"},"量化交易平台")],-1)),i("div",M,[(n(),l(u,null,r(R,a=>c(t,{key:a.path,to:a.path,class:"nav-tab","active-class":"active"},{default:o(()=>[p(m(a.label),1)]),_:2},1032,["to"])),64))])]),i("div",z,[d(P).devMode?(n(),l("div",A,[...s[1]||(s[1]=[i("span",null,"开发者模式",-1)])])):f("",!0),d(P).user?(n(),l("div",D,[i("span",L,m(d(P).user.email),1),i("span",E,"过期: "+m((a=d(P).user.expire_date,a?new Date(a).toLocaleDateString("zh-CN"):"")),1)])):f("",!0),i("button",{class:"action-btn success",onClick:S,disabled:Q.value},[c(y,null,{default:o(()=>[c(d(h))]),_:1}),s[2]||(s[2]=i("span",null,"启动",-1))],8,H),i("button",{class:"action-btn warning",onClick:q,disabled:!Q.value},[c(y,null,{default:o(()=>[c(d(w))]),_:1}),s[3]||(s[3]=i("span",null,"重启",-1))],8,I),i("button",{class:"action-btn info",onClick:X,disabled:!Q.value},[c(y,null,{default:o(()=>[c(d(_))]),_:1}),s[4]||(s[4]=i("span",null,"停止",-1))],8,J),i("button",{class:"action-btn danger",onClick:F},[c(y,null,{default:o(()=>[c(d(k))]),_:1}),s[5]||(s[5]=i("span",null,"终止",-1))]),i("button",{class:"action-btn logout",onClick:G},[c(y,null,{default:o(()=>[c(d(k))]),_:1}),s[6]||(s[6]=i("span",null,"登出",-1))])])];var a}),_:1}),c(x,{class:"main-content"},{default:o(()=>[c(v,{name:"fade-slide",mode:"out-in"},{default:o(()=>[Q.value?(n(),l("div",N,[...s[7]||(s[7]=[i("div",{class:"status-content"},[i("div",{class:"status-indicator"}),i("span",{class:"status-text"},"策略运行中"),i("span",{class:"status-tag"},"系统自动加载最新保存的策略")],-1)])])):f("",!0)]),_:1}),c(v,{name:"fade-slide",mode:"out-in"},{default:o(()=>[c(b)]),_:1})]),_:1})]),_:1})])}}},[["__scopeId","data-v-7cf1fcf4"]]);export{O as default};
