import{al as e,z as t,A as a,R as r,ax as o,r as n,ay as s,az as i,au as c,aA as l}from"./vue-vendor-4e581967.js";import{a as u}from"./utils-926e52e0.js";import{E as d,i as m}from"./element-plus-7a40141c.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const h=(e,t)=>{const a=e.__vccOpts||e;for(const[r,o]of t)a[r]=o;return a},v={class:"app-container"};const p=h({},[["render",function(o,n){const s=e("router-view");return t(),a("div",v,[r(s)])}],["__scopeId","data-v-4243d3c9"]]),f={},g=function(e,t,a){if(!t||0===t.length)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map(e=>{if((e=function(e){return"/"+e}(e))in f)return;f[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(!!a)for(let a=r.length-1;a>=0;a--){const o=r[a];if(o.href===e&&(!t||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${e}"]${o}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})},_=()=>{if({}.VITE_SOCKET_URL)return{}.VITE_SOCKET_URL;const e=window.location.hostname;return`${window.location.protocol}//${e}:5000`},w=u.create({baseURL:(()=>{if({}.VITE_API_BASE_URL)return{}.VITE_API_BASE_URL;const e=window.location.hostname;return`${window.location.protocol}//${e}:5000/api`})(),timeout:3e4});w.interceptors.request.use(e=>("true"===localStorage.getItem("dev_mode")&&(e.headers["X-Dev-Mode"]="true"),e),e=>Promise.reject(e)),w.interceptors.response.use(e=>e,e=>(d.error(e.message||"请求失败"),Promise.reject(e)));const y=o("auth",()=>{const e=n(!1),t=n(null),a=n(!1),r=n(!1);return{isAuthenticated:e,user:t,devMode:a,isLoggingOut:r,checkAuth:async function(){if(r.value)return!1;if(await async function(){const r=new URLSearchParams(window.location.search).get("dev_key");if(r)try{const o=await w.post("/auth/dev-mode",{key:r});if(o.data.success){a.value=!0,e.value=!0,t.value=o.data.user,localStorage.setItem("dev_mode","true");const r=new URL(window.location);return r.searchParams.delete("dev_key"),window.history.replaceState({},"",r.pathname+r.hash),!0}}catch(o){}return"true"===localStorage.getItem("dev_mode")&&(a.value=!0,e.value=!0,t.value={email:"dev@local",expire_date:"2099-12-31"},!0)}())return localStorage.setItem("user_cache",JSON.stringify(t.value)),!0;try{const a=await w.get("/auth/status"),r=a.data.user,o=localStorage.getItem("user_cache");if(a.data.authenticated&&r){if(!o)return e.value=!1,t.value=null,!1;const a=JSON.parse(o),n=a.id&&r.id&&a.id!==r.id,s=a.email!==r.email;return n||s?(localStorage.removeItem("user_cache"),e.value=!1,t.value=null,!1):(e.value=!0,t.value=r,localStorage.setItem("user_cache",JSON.stringify(r)),!0)}return e.value=!1,t.value=null,localStorage.removeItem("user_cache"),!1}catch(o){return e.value=!1,t.value=null,!1}},login:async function(a,r){const o=await w.post("/auth/login",{email:a,password:r});return o.data.success?(e.value=!0,t.value=o.data.user,localStorage.setItem("user_cache",JSON.stringify(o.data.user)),{success:!0}):{success:!1,message:o.data.message}},logout:async function(){if(r.value=!0,a.value)localStorage.removeItem("dev_mode"),a.value=!1;else try{await w.post("/auth/logout")}catch(o){}localStorage.removeItem("user_cache"),e.value=!1,t.value=null,setTimeout(()=>{r.value=!1},100)}}}),E=[{path:"/login",name:"Login",component:()=>g(()=>import("./Login-cf702c8b.js"),["js/Login-cf702c8b.js","js/vue-vendor-4e581967.js","js/element-plus-7a40141c.js","js/utils-926e52e0.js","css/Login-c322ef37.css"]),meta:{title:"登录"}},{path:"/",component:()=>g(()=>import("./Layout-3eb492ed.js"),["js/Layout-3eb492ed.js","js/vue-vendor-4e581967.js","js/element-plus-7a40141c.js","js/utils-926e52e0.js","css/Layout-929b5027.css"]),redirect:"/overview",meta:{requiresAuth:!0},children:[{path:"overview",name:"Overview",component:()=>g(()=>import("./Overview-3cbf5167.js"),["js/Overview-3cbf5167.js","js/vue-vendor-4e581967.js","js/element-plus-7a40141c.js","js/echarts-e73e11b1.js","js/utils-926e52e0.js","css/Overview-8c732218.css"]),meta:{title:"总览"}},{path:"strategy",name:"Strategy",component:()=>g(()=>import("./StrategyConfig-50fce921.js"),["js/StrategyConfig-50fce921.js","js/vue-vendor-4e581967.js","js/element-plus-7a40141c.js","js/codemirror-f84f5fce.js","js/utils-926e52e0.js","css/StrategyConfig-a10d7ed4.css"]),meta:{title:"策略配置"}},{path:"logs",name:"Logs",component:()=>g(()=>import("./LogView-f4c6ef91.js"),["js/LogView-f4c6ef91.js","js/element-plus-7a40141c.js","js/vue-vendor-4e581967.js","js/utils-926e52e0.js","css/LogView-080d1ce3.css"]),meta:{title:"运行日志"}}]}],S=s({history:i(),routes:E});S.beforeEach(async(e,t,a)=>{const r=y();r.isAuthenticated||await r.checkAuth(),!e.matched.some(e=>e.meta.requiresAuth)||r.isAuthenticated?"/login"===e.path&&r.isAuthenticated?a("/overview"):a():a("/login")});const L=c(p),I=l();document.documentElement.classList.add("dark"),L.use(I),L.use(S),L.use(m),L.mount("#app");export{h as _,w as a,_ as g,y as u};
