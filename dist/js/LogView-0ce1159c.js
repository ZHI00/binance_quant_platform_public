import{a as e,l as a}from"./utils-926e52e0.js";import{_ as s}from"./index-4259450f.js";import{E as l}from"./element-plus-ba159363.js";import{r as t,f as o,m as n,U as r,al as c,z as i,A as u,R as m,J as d,n as v,B as g,O as p,Q as f,a4 as h,M as w,D as y,P as _}from"./vue-vendor-344504bc.js";const N={class:"log-view"},I={class:"header"},O={class:"actions"},R={class:"log-time"},k={class:"log-level"},C={class:"log-message"},j={key:0,class:"empty-logs"},x=s({__name:"LogView",setup(s){const x=t([]),z=t(null),V=t(!0);let A=null;const D=async()=>{try{const a=await e.get("/api/logs");a.data.logs&&(x.value=a.data.logs.map(e=>F(e))),b()}catch(a){l.error("加载日志失败")}},F=e=>{const a=e.match(/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) - (\w+) - (.+)$/);return a?{timestamp:a[1],level:a[2],message:a[3]}:{timestamp:(new Date).toISOString(),level:"INFO",message:e}},S=async()=>{try{const a=await e.delete("/api/logs");a.data.success?(x.value=[],l.success("日志已清空")):l.error("清空日志失败: "+a.data.error)}catch(a){l.error("清空日志失败: "+a.message)}},U=e=>{var a;const s=null==(a=e.level)?void 0:a.toUpperCase();return"ERROR"===s?"log-error":"WARNING"===s||"WARN"===s?"log-warning":"INFO"===s?"log-info":""},b=()=>{V.value&&z.value&&v(()=>{z.value.scrollTop=z.value.scrollHeight})};return o(V,e=>{e&&b()}),n(()=>{D(),A=a("http://localhost:5000"),A.on("connect",()=>{}),A.on("log",e=>{x.value.push({timestamp:e.timestamp,level:e.level||"INFO",message:e.message}),x.value.length>1e3&&x.value.shift(),b()}),A.on("disconnect",()=>{})}),r(()=>{A&&A.disconnect()}),(e,a)=>{const s=c("el-button"),l=c("el-switch"),t=c("el-card");return i(),u("div",N,[m(t,null,{header:d(()=>[g("div",I,[a[3]||(a[3]=g("span",null,"策略运行日志",-1)),g("div",O,[m(s,{size:"small",onClick:S},{default:d(()=>[...a[1]||(a[1]=[p("清空",-1)])]),_:1}),m(s,{size:"small",onClick:D},{default:d(()=>[...a[2]||(a[2]=[p("刷新",-1)])]),_:1}),m(l,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),"active-text":"自动滚动",style:{"margin-left":"10px"}},null,8,["modelValue"])])])]),default:d(()=>[g("div",{class:"log-container",ref_key:"logContainer",ref:z},[(i(!0),u(f,null,h(x.value,(e,a)=>{return i(),u("div",{key:a,class:y(["log-item",U(e)])},[g("span",R,_((s=e.timestamp,s?s.includes("T")?new Date(s).toLocaleString("zh-CN"):s:"")),1),g("span",k,_(e.level),1),g("span",C,_(e.message),1)],2);var s}),128)),0===x.value.length?(i(),u("div",j," 暂无日志 ")):w("",!0)],512)]),_:1})])}}},[["__scopeId","data-v-165da47b"]]);export{x as default};
