import{aB as e,r as a,al as l,z as s,A as i,R as r,u as o,B as t,J as u,W as n,D as d,O as c,P as p,M as v,ah as m}from"./vue-vendor-e938fa8e.js";import{_ as g,u as f,a as y}from"./index-085b0b10.js";import{k as _,u as w,l as h,E as k}from"./element-plus-33351359.js";import"./utils-926e52e0.js";const x={class:"login-container"},b={class:"login-box"},z={class:"expire-status"},V={key:0,class:"status-badge frozen"},q={key:1,class:"status-badge expired"},C={key:2,class:"status-badge active"},j={class:"expire-detail"},D={key:0},U=g({__name:"Login",setup(g){const U=e(),B=f(),M=a(null),R=a(null),S=a(!1),A=a(!1),I=a(null),K=a(!1),L=a(!1),P=a({key:""}),E=a({email:"",password:""}),F={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},J=async()=>{M.value&&await M.value.validate(async e=>{if(e){S.value=!0;try{const e=await B.login(E.value.email,E.value.password);e.success?(k.success("登录成功"),U.push("/overview")):k.error(e.message||"登录失败")}catch(a){k.error("登录失败，请检查网络连接")}finally{S.value=!1}}})},N=async()=>{var e;if(!E.value.email)return void k.warning("请先输入邮箱地址");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E.value.email)){A.value=!0,I.value=null;try{const e=await y.get("/auth/check-expire",{params:{email:E.value.email}});I.value=e.data,e.data.is_frozen?k.warning("账户已被冻结，请联系管理员"):e.data.is_expired?k.warning("账户已过期，请联系管理员续费"):k.success("查询成功")}catch(a){404===(null==(e=a.response)?void 0:e.status)?k.error("账户不存在"):k.error("查询失败，请检查网络连接或联系管理员")}finally{A.value=!1}}else k.warning("请输入有效的邮箱地址")},O=e=>{const a=new Date,l=new Date(e)-a;return Math.ceil(l/864e5)},Q=async()=>{if(P.value.key){L.value=!0;try{const e=await y.post("/auth/dev-mode",{key:P.value.key});e.data.success?(B.devMode=!0,B.isAuthenticated=!0,B.user=e.data.user,localStorage.setItem("dev_mode","true"),k.success("开发者模式已启用"),K.value=!1,P.value.key="",U.push("/overview")):k.error(e.data.message||"密钥错误")}catch(e){k.error("验证失败，请检查密钥是否正确")}finally{L.value=!1}}else k.warning("请输入开发者密钥")};return(e,a)=>{const g=l("el-button"),f=l("el-input"),y=l("el-form-item"),k=l("el-form"),U=l("el-dialog");return s(),i("div",x,[r(g,{class:"dev-mode-btn",icon:o(_),circle:"",onClick:a[0]||(a[0]=e=>K.value=!0),title:"开发者模式"},null,8,["icon"]),t("div",b,[a[11]||(a[11]=t("div",{class:"login-header"},[t("div",{class:"logo-icon"},"₿"),t("h1",{class:"title"},"量化交易平台"),t("p",{class:"subtitle"},"Binance Quant Platform")],-1)),r(k,{model:E.value,rules:F,ref_key:"formRef",ref:M,class:"login-form",onSubmit:n(J,["prevent"])},{default:u(()=>[r(y,{prop:"email"},{default:u(()=>[r(f,{modelValue:E.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value.email=e),placeholder:"邮箱","prefix-icon":o(w),size:"large",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),r(y,{prop:"password"},{default:u(()=>[r(f,{modelValue:E.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>E.value.password=e),type:"password",placeholder:"密码","prefix-icon":o(h),size:"large","show-password":"",onKeyup:m(J,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),r(g,{type:"primary",size:"large",class:"login-btn",loading:S.value,onClick:J},{default:u(()=>[...a[6]||(a[6]=[c(" 登录 ",-1)])]),_:1},8,["loading"]),r(g,{type:"info",size:"large",class:"check-expire-btn",loading:A.value,onClick:N},{default:u(()=>[...a[7]||(a[7]=[c(" 查询账户时长 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"]),I.value?(s(),i("div",{key:0,class:d(["expire-info",{expired:I.value.is_expired,frozen:I.value.is_frozen}])},[t("div",z,[I.value.is_frozen?(s(),i("span",V,"账户已冻结")):I.value.is_expired?(s(),i("span",q,"账户已过期")):(s(),i("span",C,"账户正常"))]),t("div",j,[t("p",null,[a[8]||(a[8]=t("strong",null,"邮箱：",-1)),c(p(I.value.email),1)]),t("p",null,[a[9]||(a[9]=t("strong",null,"到期时间：",-1)),c(p((B=I.value.expire_date,new Date(B).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1)]),I.value.is_expired||I.value.is_frozen?v("",!0):(s(),i("p",D,[a[10]||(a[10]=t("strong",null,"剩余天数：",-1)),c(p(O(I.value.expire_date))+" 天 ",1)]))])],2)):v("",!0),a[12]||(a[12]=t("div",{class:"tips"},[t("p",null,"如需注册账户，请联系管理员"),t("p",null,"忘记密码？请联系管理员重置"),t("p",{class:"contact-author"},[t("span",null,"联系作者："),t("a",{href:"mailto:1014010673@qq.com",class:"email-link"},"1014010673@qq.com")])],-1))]),r(U,{modelValue:K.value,"onUpdate:modelValue":a[5]||(a[5]=e=>K.value=e),title:"开发者模式",width:"400px","close-on-click-modal":!1},{footer:u(()=>[r(g,{onClick:a[4]||(a[4]=e=>K.value=!1)},{default:u(()=>[...a[13]||(a[13]=[c("取消",-1)])]),_:1}),r(g,{type:"primary",loading:L.value,onClick:Q},{default:u(()=>[...a[14]||(a[14]=[c(" 确认 ",-1)])]),_:1},8,["loading"])]),default:u(()=>[r(k,{model:P.value,ref_key:"devFormRef",ref:R},{default:u(()=>[r(y,{label:"开发者密钥",prop:"key"},{default:u(()=>[r(f,{modelValue:P.value.key,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value.key=e),type:"password",placeholder:"请输入开发者密钥","show-password":"",onKeyup:m(Q,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]);var B}}},[["__scopeId","data-v-98045ca7"]]);export{U as default};
