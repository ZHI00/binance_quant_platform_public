import{_ as e,a}from"./index-b37a5370.js";import{E as l}from"./element-plus-7a40141c.js";import{r as s,h as t,m as o,U as n,al as r,z as c,A as u,R as i,J as d,n as v,B as m,O as g,Q as p,a4 as f,M as h,D as w,P as y}from"./vue-vendor-4e581967.js";import"./utils-926e52e0.js";const _={class:"log-view"},I={class:"header"},N={class:"actions"},R={class:"log-time"},k={class:"log-level"},C={class:"log-message"},O={key:0,class:"empty-logs"},j=e({__name:"LogView",setup(e){const j=s([]),x=s(null),z=s(!0);let V=null;const A=async()=>{try{const e=await a.get("/logs");e.data.logs&&(j.value=e.data.logs.map(e=>D(e)),j.value.length>1e3&&(j.value=j.value.slice(-1e3))),E()}catch(e){}},D=e=>{const a=e.match(/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) - (\w+) - (.+)$/);return a?{timestamp:a[1],level:a[2],message:a[3]}:{timestamp:(new Date).toISOString(),level:"INFO",message:e}},S=async()=>{try{const e=await a.delete("/logs");e.data.success?(j.value=[],l.success("日志已清空")):l.error("清空日志失败: "+e.data.error)}catch(e){l.error("清空日志失败: "+e.message)}},U=e=>{var a;const l=null==(a=e.level)?void 0:a.toUpperCase();return"ERROR"===l?"log-error":"WARNING"===l||"WARN"===l?"log-warning":"INFO"===l?"log-info":""},E=()=>{z.value&&x.value&&v(()=>{x.value.scrollTop=x.value.scrollHeight})};return t(z,e=>{e&&E()}),o(()=>{A(),V=setInterval(()=>{A()},2e3)}),n(()=>{V&&(clearInterval(V),V=null)}),(e,a)=>{const l=r("el-button"),s=r("el-switch"),t=r("el-card");return c(),u("div",_,[i(t,null,{header:d(()=>[m("div",I,[a[3]||(a[3]=m("span",null,"策略运行日志",-1)),m("div",N,[i(l,{size:"small",onClick:S},{default:d(()=>[...a[1]||(a[1]=[g("清空",-1)])]),_:1}),i(l,{size:"small",onClick:A},{default:d(()=>[...a[2]||(a[2]=[g("刷新",-1)])]),_:1}),i(s,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),"active-text":"自动滚动",style:{"margin-left":"10px"}},null,8,["modelValue"])])])]),default:d(()=>[m("div",{class:"log-container",ref_key:"logContainer",ref:x},[(c(!0),u(p,null,f(j.value,(e,a)=>{return c(),u("div",{key:a,class:w(["log-item",U(e)])},[m("span",R,y((l=e.timestamp,l?l.includes("T")?new Date(l).toLocaleString("zh-CN"):l:"")),1),m("span",k,y(e.level),1),m("span",C,y(e.message),1)],2);var l}),128)),0===j.value.length?(c(),u("div",O," 暂无日志 ")):h("",!0)],512)]),_:1})])}}},[["__scopeId","data-v-d12443f4"]]);export{j as default};
