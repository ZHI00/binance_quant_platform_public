import{r as e,m as a,U as l,al as t,z as i,A as s,R as o,J as n,B as r,u as d,O as u,P as p,I as c,D as _,ah as y}from"./vue-vendor-e938fa8e.js";import{E as f,a as m,d as v,e as b,w as h,f as g,t as w,g as x,h as S,j as k}from"./element-plus-9e07dff4.js";import{_ as V,a as z,g as U}from"./index-b1bcf135.js";import{i as A}from"./echarts-e73e11b1.js";import{l as D}from"./utils-926e52e0.js";const I={class:"overview-container"},L={class:"card-header"},C={key:0},T={key:0},$={key:0},P={class:"card-header"},j={class:"stat-card"},q={class:"stat-value"},K={class:"stat-card"},N={class:"stat-value"},O={class:"stat-card"},B={class:"card-header"},M={class:"header-actions"},G={class:"initial-capital-input"},F={class:"card-header"},R={class:"header-title"},E={style:{"overflow-x":"auto"}},H={key:1},J={class:"card-header"},Y={style:{"overflow-x":"auto"}},Q={key:1},W=V({__name:"Overview",setup(V){const W=e(!1),X=e({binance_api_key:"",binance_api_secret:"",ai_model:"gpt-4",ai_base_url:"https://api.openai.com",ai_api_key:"",initial_capital:1e3}),Z=e({total_balance:0,available_balance:0,total_unrealized_pnl:0}),ee=e([]),ae=e([]),le=e(null);let te=null,ie=null;const se=e=>!e||e.length<8?"***":e.substring(0,4)+"****"+e.substring(e.length-4),oe=e=>e?Number(e).toFixed(2):"0.00",ne=e=>{if(!e)return"-";try{const a=new Date(e),l=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0"),s=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0");return`${l}-${t}-${i} ${s}:${o}:${String(a.getSeconds()).padStart(2,"0")}`}catch(a){return e}},re=async()=>{try{await z.post("/config",X.value),f.success("配置保存成功"),W.value=!1,de(),pe()}catch(e){f.error("保存配置失败")}},de=async()=>{try{const e=await z.get("/account");e.data.success&&(Z.value=e.data)}catch(e){}},ue=async()=>{try{const e=await z.get("/strategy/positions");if(e.data.success)ee.value=e.data.positions||[];else{const e=await z.get("/positions");ee.value=e.data.current||[]}const a=(await z.get("/positions")).data.history||[];ae.value=a.sort((e,a)=>new Date(a.exit_time)-new Date(e.exit_time))}catch(e){f.error("加载仓位失败")}},pe=async()=>{try{const e=(await z.get("/positions")).data.history||[],a=X.value.initial_capital||1e3;let l=0;const t=[{time:"起始",equity:a}];[...e].sort((e,a)=>new Date(e.exit_time)-new Date(a.exit_time)).forEach(e=>{l+=e.pnl||0,t.push({time:new Date(e.exit_time).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),equity:a+l,symbol:e.symbol,pnl:e.pnl})}),1===t.length&&t.push({time:"当前",equity:a}),ce(t)}catch(e){}},ce=e=>{if(!te)return;const a=e.map(e=>e.time),l=e.map(e=>({value:e.equity,symbol:e.symbol,pnl:e.pnl}));te.setOption({xAxis:{data:a},series:[{data:l}]},{notMerge:!1,lazyUpdate:!0})};let _e=null;const ye=async()=>{try{const e=X.value.initial_capital;if(e===_e)return;if(!e||e<=0)return void f.warning("请输入有效的初始资金");await z.patch("/config",{initial_capital:e}),_e=e,f.success("初始资金已更新"),pe()}catch(e){f.error("保存失败")}},fe=async()=>{try{await m.confirm("确定要清除所有历史数据吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await z.delete("/positions/history");e.data.success?(f.success("历史数据已清除"),ae.value=[],pe()):f.error(e.data.error||"清除失败")}catch(e){"cancel"!==e&&(e.response&&e.response.data&&e.response.data.error?f.error(e.response.data.error):f.error("清除失败: "+e.message))}};return a(()=>{(async()=>{try{const e=await z.get("/config");X.value={...X.value,...e.data},_e=X.value.initial_capital}catch(e){f.error("加载配置失败")}})(),de(),ue(),(()=>{if(!le.value)return;te=A(le.value);const e={tooltip:{trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"rgba(17, 17, 17, 0.95)",borderColor:"rgba(255, 255, 255, 0.1)",textStyle:{color:"#fff"},formatter:e=>{const a=e[0];if(!a)return"";const l=a.data,t="object"==typeof l?l.value:l;let i=`<div style="padding: 8px;">\n          <div style="margin-bottom: 8px; font-weight: 600;">${a.name}</div>\n          <div style="margin-bottom: 4px;">\n            <span style="color: #409eff;">账户余额:</span> \n            <span style="font-weight: 600;">${Number(t).toFixed(2)} USDT</span>\n          </div>`;return"object"==typeof l&&l.symbol&&(i+=`<div style="margin-bottom: 4px;">\n            <span style="color: rgba(255, 255, 255, 0.7);">交易对:</span> \n            <span>${l.symbol}</span>\n          </div>`),"object"==typeof l&&void 0!==l.pnl&&(i+=`<div>\n            <span style="color: rgba(255, 255, 255, 0.7);">本次盈亏:</span> \n            <span style="color: ${l.pnl>=0?"#10b981":"#ef4444"}; font-weight: 600;">\n              ${l.pnl>=0?"+":""}${Number(l.pnl).toFixed(2)} USDT\n            </span>\n          </div>`),i+="</div>",i}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{color:"rgba(255, 255, 255, 0.6)",rotate:30},axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.1)"}}},yAxis:{type:"value",axisLabel:{formatter:"{value} USDT",color:"rgba(255, 255, 255, 0.6)"},splitLine:{lineStyle:{color:"rgba(255, 255, 255, 0.05)"}},axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.1)"}}},series:[{name:"账户余额",type:"line",data:[],smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.05)"}]}},lineStyle:{color:"#409eff",width:2},itemStyle:{color:"#409eff"}}]};te.setOption(e)})(),pe(),ie=D(U()),ie.on("connect",()=>{}),ie.on("positions_updated",e=>{f.info({message:e.message,duration:3e3}),ue(),pe()}),ie.on("disconnect",()=>{});const e=setInterval(()=>{de(),ue(),pe()},3e4);l(()=>{clearInterval(e),te&&te.dispose(),ie&&ie.disconnect()})}),(e,a)=>{const l=t("el-icon"),m=t("el-button"),V=t("el-tag"),U=t("el-descriptions-item"),A=t("el-descriptions"),D=t("el-card"),te=t("el-divider"),ie=t("el-input"),ce=t("el-form-item"),_e=t("el-form"),me=t("el-dialog"),ve=t("el-col"),be=t("el-row"),he=t("el-badge"),ge=t("el-table-column"),we=t("el-table");return i(),s("div",I,[o(D,{class:"config-card",shadow:"hover"},{header:n(()=>[r("div",L,[r("span",null,[o(l,null,{default:n(()=>[o(d(v))]),_:1}),a[10]||(a[10]=u(" 基础配置",-1))]),o(m,{type:"primary",size:"small",onClick:a[0]||(a[0]=e=>W.value=!0)},{default:n(()=>[o(l,null,{default:n(()=>[o(d(b))]),_:1}),a[11]||(a[11]=u(" 编辑配置 ",-1))]),_:1})])]),default:n(()=>[o(A,{column:2,border:""},{default:n(()=>[o(U,{label:"币安API"},{default:n(()=>[X.value.binance_api_key?(i(),s("span",C,p(se(X.value.binance_api_key)),1)):(i(),c(V,{key:1,type:"warning"},{default:n(()=>[...a[12]||(a[12]=[u("未配置",-1)])]),_:1}))]),_:1}),o(U,{label:"AI模型"},{default:n(()=>[X.value.ai_model?(i(),c(V,{key:0,type:"success"},{default:n(()=>[u(p(X.value.ai_model),1)]),_:1})):(i(),c(V,{key:1,type:"info"},{default:n(()=>[...a[13]||(a[13]=[u("未配置",-1)])]),_:1}))]),_:1}),o(U,{label:"AI Base URL"},{default:n(()=>[u(p(X.value.ai_base_url||"未配置"),1)]),_:1}),o(U,{label:"AI API Key"},{default:n(()=>[X.value.ai_api_key?(i(),s("span",T,p(se(X.value.ai_api_key)),1)):(i(),c(V,{key:1,type:"warning"},{default:n(()=>[...a[14]||(a[14]=[u("未配置",-1)])]),_:1}))]),_:1}),o(U,{label:"策略本金"},{default:n(()=>[X.value.initial_capital?(i(),s("span",$,p(oe(X.value.initial_capital))+" USDT",1)):(i(),c(V,{key:1,type:"warning"},{default:n(()=>[...a[15]||(a[15]=[u("未设置",-1)])]),_:1}))]),_:1})]),_:1})]),_:1}),o(me,{modelValue:W.value,"onUpdate:modelValue":a[8]||(a[8]=e=>W.value=e),title:"编辑基础配置",width:"700px"},{footer:n(()=>[o(m,{onClick:a[7]||(a[7]=e=>W.value=!1)},{default:n(()=>[...a[20]||(a[20]=[u("取消",-1)])]),_:1}),o(m,{type:"primary",onClick:re},{default:n(()=>[...a[21]||(a[21]=[u("保存配置",-1)])]),_:1})]),default:n(()=>[o(_e,{model:X.value,"label-width":"120px"},{default:n(()=>[o(te,{"content-position":"left"},{default:n(()=>[...a[16]||(a[16]=[u("币安配置",-1)])]),_:1}),o(ce,{label:"API Key"},{default:n(()=>[o(ie,{modelValue:X.value.binance_api_key,"onUpdate:modelValue":a[1]||(a[1]=e=>X.value.binance_api_key=e),placeholder:"请输入币安API Key","show-password":""},null,8,["modelValue"])]),_:1}),o(ce,{label:"API Secret"},{default:n(()=>[o(ie,{modelValue:X.value.binance_api_secret,"onUpdate:modelValue":a[2]||(a[2]=e=>X.value.binance_api_secret=e),type:"password",placeholder:"请输入币安API Secret","show-password":""},null,8,["modelValue"])]),_:1}),o(te,{"content-position":"left"},{default:n(()=>[...a[17]||(a[17]=[u("AI配置",-1)])]),_:1}),o(ce,{label:"AI Model"},{default:n(()=>[o(ie,{modelValue:X.value.ai_model,"onUpdate:modelValue":a[3]||(a[3]=e=>X.value.ai_model=e),placeholder:"例如: gpt-4, gpt-3.5-turbo"},null,8,["modelValue"])]),_:1}),o(ce,{label:"Base URL"},{default:n(()=>[o(ie,{modelValue:X.value.ai_base_url,"onUpdate:modelValue":a[4]||(a[4]=e=>X.value.ai_base_url=e),placeholder:"例如: https://api.openai.com"},null,8,["modelValue"])]),_:1}),o(ce,{label:"API Key"},{default:n(()=>[o(ie,{modelValue:X.value.ai_api_key,"onUpdate:modelValue":a[5]||(a[5]=e=>X.value.ai_api_key=e),type:"password",placeholder:"请输入AI API Key","show-password":""},null,8,["modelValue"])]),_:1}),o(te,{"content-position":"left"},{default:n(()=>[...a[18]||(a[18]=[u("策略配置",-1)])]),_:1}),o(ce,{label:"策略本金"},{default:n(()=>[o(ie,{modelValue:X.value.initial_capital,"onUpdate:modelValue":a[6]||(a[6]=e=>X.value.initial_capital=e),modelModifiers:{number:!0},type:"number",placeholder:"请输入策略本金（USDT）"},{append:n(()=>[...a[19]||(a[19]=[u("USDT",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(D,{class:"account-card",shadow:"hover"},{header:n(()=>[r("div",P,[r("span",null,[o(l,null,{default:n(()=>[o(d(h))]),_:1}),a[22]||(a[22]=u(" 账户信息",-1))]),o(m,{size:"small",onClick:de,icon:d(g)},{default:n(()=>[...a[23]||(a[23]=[u("刷新",-1)])]),_:1},8,["icon"])])]),default:n(()=>[o(be,{gutter:20,class:"account-stats"},{default:n(()=>[o(ve,{span:8},{default:n(()=>[r("div",j,[a[25]||(a[25]=r("div",{class:"stat-label"},"总余额",-1)),r("div",q,[u(p(oe(Z.value.total_balance))+" ",1),a[24]||(a[24]=r("span",{class:"unit"},"USDT",-1))])])]),_:1}),o(ve,{span:8},{default:n(()=>[r("div",K,[a[27]||(a[27]=r("div",{class:"stat-label"},"可用余额",-1)),r("div",N,[u(p(oe(Z.value.available_balance))+" ",1),a[26]||(a[26]=r("span",{class:"unit"},"USDT",-1))])])]),_:1}),o(ve,{span:8},{default:n(()=>{return[r("div",O,[a[29]||(a[29]=r("div",{class:"stat-label"},"未实现盈亏",-1)),r("div",{class:_(["stat-value",(e=Z.value.total_unrealized_pnl,e>0?"positive":e<0?"negative":"")])},[u(p(oe(Z.value.total_unrealized_pnl))+" ",1),a[28]||(a[28]=r("span",{class:"unit"},"USDT",-1))],2)])];var e}),_:1})]),_:1})]),_:1}),o(D,{class:"chart-card",shadow:"hover"},{header:n(()=>[r("div",B,[r("span",null,[o(l,null,{default:n(()=>[o(d(w))]),_:1}),a[30]||(a[30]=u(" 资金曲线（策略盈亏）",-1))]),r("div",M,[r("div",G,[a[31]||(a[31]=r("span",{class:"input-label"},"初始资金:",-1)),o(ie,{modelValue:X.value.initial_capital,"onUpdate:modelValue":a[9]||(a[9]=e=>X.value.initial_capital=e),modelModifiers:{number:!0},type:"number",size:"small",class:"capital-input",onBlur:ye,onKeyup:y(ye,["enter"]),placeholder:"1000"},null,8,["modelValue"]),a[32]||(a[32]=r("span",{class:"input-unit"},"USDT",-1))]),o(m,{size:"small",type:"danger",onClick:fe,icon:d(x)},{default:n(()=>[...a[33]||(a[33]=[u("重置",-1)])]),_:1},8,["icon"]),o(m,{size:"small",onClick:pe,icon:d(g)},{default:n(()=>[...a[34]||(a[34]=[u("刷新",-1)])]),_:1},8,["icon"])])])]),default:n(()=>[r("div",{ref_key:"chartRef",ref:le,style:{width:"100%",height:"350px"}},null,512)]),_:1}),o(D,{class:"positions-card",shadow:"hover"},{header:n(()=>[r("div",F,[r("span",R,[o(l,null,{default:n(()=>[o(d(S))]),_:1}),a[35]||(a[35]=r("span",null,"当前仓位",-1)),o(he,{value:ee.value.length,class:"badge"},null,8,["value"])]),o(m,{size:"small",onClick:ue,icon:d(g)},{default:n(()=>[...a[36]||(a[36]=[u("刷新",-1)])]),_:1},8,["icon"])])]),default:n(()=>[r("div",E,[o(we,{data:ee.value,stripe:"",style:{"min-width":"1200px"}},{default:n(()=>[o(ge,{type:"index",label:"序号",width:"60",align:"center"}),o(ge,{prop:"symbol",label:"标的",width:"160"},{default:n(({row:e})=>[o(V,{type:"primary"},{default:n(()=>[u(p(e.symbol),1)]),_:2},1024)]),_:1}),o(ge,{prop:"positionSide",label:"方向",width:"100",align:"center"},{default:n(({row:e})=>[o(V,{type:"LONG"===e.positionSide?"success":"danger",size:"small"},{default:n(()=>[u(p("LONG"===e.positionSide?"做多":"做空"),1)]),_:2},1032,["type"])]),_:1}),o(ge,{prop:"entry_time",label:"开仓时间"},{default:n(({row:e})=>[u(p(ne(e.entry_time)),1)]),_:1}),o(ge,{prop:"entry_price",label:"开仓价格"}),o(ge,{prop:"quantity",label:"数量"},{default:n(({row:e})=>[u(p(oe(e.quantity)),1)]),_:1}),o(ge,{prop:"hold_bars",label:"当前K线"}),o(ge,{prop:"max_hold_bars",label:"最大K线"},{default:n(({row:e})=>[u(p(e.max_hold_bars||"-"),1)]),_:1}),o(ge,{prop:"unrealized_pnl",label:"利润"},{default:n(({row:e})=>[o(V,{type:(e.unrealized_pnl||0)>=0?"success":"danger",size:"small"},{default:n(()=>[u(p((e.unrealized_pnl||0)>=0?"+":"")+p(oe(e.unrealized_pnl||0)),1)]),_:2},1032,["type"])]),_:1}),o(ge,{prop:"client_order_id",label:"自定义订单号",width:"300","show-overflow-tooltip":""},{default:n(({row:e})=>[e.client_order_id?(i(),c(V,{key:0,size:"small"},{default:n(()=>[u(p(e.client_order_id),1)]),_:2},1024)):(i(),s("span",H,p(e.order_id),1))]),_:1}),o(ge,{label:"操作"},{default:n(({row:e})=>[o(m,{type:"danger",size:"small",onClick:a=>(async e=>{try{const a=await z.post("/positions/close",{symbol:e.symbol});a.data.success?(f.success("平仓成功"),ue(),pe()):f.error(a.data.error||"平仓失败")}catch(a){f.error("平仓失败: "+a.message)}})(e)},{default:n(()=>[...a[37]||(a[37]=[u("平仓",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),o(D,{class:"history-card",shadow:"hover"},{header:n(()=>[r("div",J,[r("span",null,[o(l,null,{default:n(()=>[o(d(k))]),_:1}),a[38]||(a[38]=u(" 历史仓位",-1))])])]),default:n(()=>[r("div",Y,[o(we,{data:ae.value,stripe:"","max-height":"350",style:{"min-width":"1200px"}},{default:n(()=>[o(ge,{type:"index",label:"序号",width:"60",align:"center"}),o(ge,{prop:"symbol",label:"标的",width:"160"},{default:n(({row:e})=>[o(V,null,{default:n(()=>[u(p(e.symbol),1)]),_:2},1024)]),_:1}),o(ge,{prop:"positionSide",label:"方向",width:"100",align:"center"},{default:n(({row:e})=>[o(V,{type:"LONG"===e.positionSide?"success":"danger",size:"small"},{default:n(()=>[u(p("LONG"===e.positionSide?"做多":"做空"),1)]),_:2},1032,["type"])]),_:1}),o(ge,{prop:"entry_time",label:"开仓时间"},{default:n(({row:e})=>[u(p(ne(e.entry_time)),1)]),_:1}),o(ge,{prop:"exit_time",label:"平仓时间"},{default:n(({row:e})=>[u(p(ne(e.exit_time)),1)]),_:1}),o(ge,{prop:"entry_price",label:"开仓价格"},{default:n(({row:e})=>[u(p(oe(e.entry_price)),1)]),_:1}),o(ge,{prop:"exit_price",label:"平仓价格"},{default:n(({row:e})=>[u(p(oe(e.exit_price)),1)]),_:1}),o(ge,{prop:"quantity",label:"数量"},{default:n(({row:e})=>[u(p(oe(e.quantity)),1)]),_:1}),o(ge,{prop:"pnl",label:"盈亏"},{default:n(({row:e})=>[o(V,{type:(e.pnl||0)>=0?"success":"danger"},{default:n(()=>[u(p((e.pnl||0)>=0?"+":"")+p(oe(e.pnl||0)),1)]),_:2},1032,["type"])]),_:1}),o(ge,{prop:"client_order_id",label:"自定义订单号",width:"300","show-overflow-tooltip":""},{default:n(({row:e})=>[e.client_order_id?(i(),c(V,{key:0,size:"small"},{default:n(()=>[u(p(e.client_order_id),1)]),_:2},1024)):(i(),s("span",Q,p(e.order_id),1))]),_:1})]),_:1},8,["data"])])]),_:1})])}}},[["__scopeId","data-v-71b27153"]]);export{W as default};
