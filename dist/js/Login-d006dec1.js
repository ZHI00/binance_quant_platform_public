import{aB as e,r as a,al as l,z as s,A as r,M as i,B as o,R as t,J as u,W as n,D as d,O as c,P as p,u as v,ah as m}from"./vue-vendor-e938fa8e.js";import{_ as g,u as f,a as y}from"./index-47cfd9be.js";import{E as _,u as w,l as h}from"./element-plus-9e07dff4.js";import"./utils-926e52e0.js";const k={class:"login-container"},x={class:"login-box"},b={class:"expire-status"},z={key:0,class:"status-badge frozen"},V={key:1,class:"status-badge expired"},q={key:2,class:"status-badge active"},C={class:"expire-detail"},j={key:0},D=g({__name:"Login",setup(g){const D=e(),U=f(),B=a(null),M=a(null),R=a(!1),S=a(!1),A=a(null),I=a(!1),K=a(!1),L=a({key:""}),P=a({email:"",password:""}),E={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},F=async()=>{B.value&&await B.value.validate(async e=>{if(e){R.value=!0;try{const e=await U.login(P.value.email,P.value.password);e.success?(_.success("登录成功"),D.push("/overview")):_.error(e.message||"登录失败")}catch(a){_.error("登录失败，请检查网络连接")}finally{R.value=!1}}})},J=async()=>{var e;if(!P.value.email)return void _.warning("请先输入邮箱地址");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P.value.email)){S.value=!0,A.value=null;try{const e=await y.get("/auth/check-expire",{params:{email:P.value.email}});A.value=e.data,e.data.is_frozen?_.warning("账户已被冻结，请联系管理员"):e.data.is_expired?_.warning("账户已过期，请联系管理员续费"):_.success("查询成功")}catch(a){404===(null==(e=a.response)?void 0:e.status)?_.error("账户不存在"):_.error("查询失败，请检查网络连接或联系管理员")}finally{S.value=!1}}else _.warning("请输入有效的邮箱地址")},N=e=>{const a=new Date,l=new Date(e)-a;return Math.ceil(l/864e5)},O=async()=>{if(L.value.key){K.value=!0;try{const e=await y.post("/auth/dev-mode",{key:L.value.key});e.data.success?(U.devMode=!0,U.isAuthenticated=!0,U.user=e.data.user,localStorage.setItem("dev_mode","true"),_.success("开发者模式已启用"),I.value=!1,L.value.key="",D.push("/overview")):_.error(e.data.message||"密钥错误")}catch(e){_.error("验证失败，请检查密钥是否正确")}finally{K.value=!1}}else _.warning("请输入开发者密钥")};return(e,a)=>{const g=l("el-button"),f=l("el-input"),y=l("el-form-item"),_=l("el-form"),D=l("el-dialog");return s(),r("div",k,[i("",!0),o("div",x,[a[11]||(a[11]=o("div",{class:"login-header"},[o("div",{class:"logo-icon"},"₿"),o("h1",{class:"title"},"量化交易平台"),o("p",{class:"subtitle"},"Binance Quant Platform")],-1)),t(_,{model:P.value,rules:E,ref_key:"formRef",ref:B,class:"login-form",onSubmit:n(F,["prevent"])},{default:u(()=>[t(y,{prop:"email"},{default:u(()=>[t(f,{modelValue:P.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value.email=e),placeholder:"邮箱","prefix-icon":v(w),size:"large",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),t(y,{prop:"password"},{default:u(()=>[t(f,{modelValue:P.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.password=e),type:"password",placeholder:"密码","prefix-icon":v(h),size:"large","show-password":"",onKeyup:m(F,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),t(g,{type:"primary",size:"large",class:"login-btn",loading:R.value,onClick:F},{default:u(()=>[...a[6]||(a[6]=[c(" 登录 ",-1)])]),_:1},8,["loading"]),t(g,{type:"info",size:"large",class:"check-expire-btn",loading:S.value,onClick:J},{default:u(()=>[...a[7]||(a[7]=[c(" 查询账户时长 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"]),A.value?(s(),r("div",{key:0,class:d(["expire-info",{expired:A.value.is_expired,frozen:A.value.is_frozen}])},[o("div",b,[A.value.is_frozen?(s(),r("span",z,"账户已冻结")):A.value.is_expired?(s(),r("span",V,"账户已过期")):(s(),r("span",q,"账户正常"))]),o("div",C,[o("p",null,[a[8]||(a[8]=o("strong",null,"邮箱：",-1)),c(p(A.value.email),1)]),o("p",null,[a[9]||(a[9]=o("strong",null,"到期时间：",-1)),c(p((U=A.value.expire_date,new Date(U).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1)]),A.value.is_expired||A.value.is_frozen?i("",!0):(s(),r("p",j,[a[10]||(a[10]=o("strong",null,"剩余天数：",-1)),c(p(N(A.value.expire_date))+" 天 ",1)]))])],2)):i("",!0),a[12]||(a[12]=o("div",{class:"tips"},[o("p",null,"如需注册账户，请联系管理员"),o("p",null,"忘记密码？请联系管理员重置"),o("p",{class:"contact-author"},[o("span",null,"联系作者："),o("a",{href:"mailto:1014010673@qq.com",class:"email-link"},"1014010673@qq.com")])],-1))]),t(D,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=e=>I.value=e),title:"开发者模式",width:"400px","close-on-click-modal":!1},{footer:u(()=>[t(g,{onClick:a[4]||(a[4]=e=>I.value=!1)},{default:u(()=>[...a[13]||(a[13]=[c("取消",-1)])]),_:1}),t(g,{type:"primary",loading:K.value,onClick:O},{default:u(()=>[...a[14]||(a[14]=[c(" 确认 ",-1)])]),_:1},8,["loading"])]),default:u(()=>[t(_,{model:L.value,ref_key:"devFormRef",ref:M},{default:u(()=>[t(y,{label:"开发者密钥",prop:"key"},{default:u(()=>[t(f,{modelValue:L.value.key,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value.key=e),type:"password",placeholder:"请输入开发者密钥","show-password":"",onKeyup:m(O,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]);var U}}},[["__scopeId","data-v-c240417f"]]);export{D as default};
