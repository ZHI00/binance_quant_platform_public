import{r as e,m as a,U as l,al as t,z as i,A as o,R as s,J as n,B as r,u as d,O as u,P as p,I as c,D as _,ah as y}from"./vue-vendor-344504bc.js";import{E as f,a as m,c as v,e as b,w as h,d as g,t as w,f as x,g as k,h as S}from"./element-plus-ba159363.js";import{a as V}from"./utils-926e52e0.js";import{i as U}from"./echarts-e73e11b1.js";import{_ as z}from"./index-4259450f.js";const A={class:"overview-container"},D={class:"card-header"},I={key:0},C={key:0},T={key:0},$={class:"card-header"},P={class:"stat-card"},L={class:"stat-value"},j={class:"stat-card"},q={class:"stat-value"},K={class:"stat-card"},B={class:"card-header"},M={class:"header-actions"},F={class:"initial-capital-input"},N={class:"card-header"},O={class:"header-title"},R={style:{"overflow-x":"auto"}},E={key:1},G={class:"card-header"},H={style:{"overflow-x":"auto"}},J={key:1},Y=z({__name:"Overview",setup(z){const Y=e(!1),Q=e({binance_api_key:"",binance_api_secret:"",ai_model:"gpt-4",ai_base_url:"https://api.openai.com",ai_api_key:"",initial_capital:1e3}),W=e({total_balance:0,available_balance:0,total_unrealized_pnl:0}),X=e([]),Z=e([]),ee=e(null);let ae=null;const le=e=>!e||e.length<8?"***":e.substring(0,4)+"****"+e.substring(e.length-4),te=e=>e?Number(e).toFixed(2):"0.00",ie=e=>{if(!e)return"-";try{const a=new Date(e),l=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0"),o=String(a.getHours()).padStart(2,"0"),s=String(a.getMinutes()).padStart(2,"0");return`${l}-${t}-${i} ${o}:${s}:${String(a.getSeconds()).padStart(2,"0")}`}catch(a){return e}},oe=async()=>{try{await V.post("/api/config",Q.value),f.success("配置保存成功"),Y.value=!1,se(),re()}catch(e){f.error("保存配置失败")}},se=async()=>{try{const e=await V.get("/api/account");e.data.success&&(W.value=e.data)}catch(e){}},ne=async()=>{try{const e=await V.get("/api/strategy/positions");if(e.data.success)X.value=e.data.positions||[];else{const e=await V.get("/api/positions");X.value=e.data.current||[]}const a=(await V.get("/api/positions")).data.history||[];Z.value=a.sort((e,a)=>new Date(a.exit_time)-new Date(e.exit_time))}catch(e){f.error("加载仓位失败")}},re=async()=>{try{const e=(await V.get("/api/positions")).data.history||[],a=Q.value.initial_capital||1e3;let l=0;const t=[{time:"起始",equity:a}];[...e].sort((e,a)=>new Date(e.exit_time)-new Date(a.exit_time)).forEach(e=>{l+=e.pnl||0,t.push({time:new Date(e.exit_time).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),equity:a+l,symbol:e.symbol,pnl:e.pnl})}),1===t.length&&t.push({time:"当前",equity:a}),de(t)}catch(e){}},de=e=>{if(!ae)return;const a=e.map(e=>e.time),l=e.map(e=>({value:e.equity,symbol:e.symbol,pnl:e.pnl}));ae.setOption({xAxis:{data:a},series:[{data:l}]},{notMerge:!1,lazyUpdate:!0})};let ue=null;const pe=async()=>{try{const e=Q.value.initial_capital;if(e===ue)return;if(!e||e<=0)return void f.warning("请输入有效的初始资金");await V.patch("/api/config",{initial_capital:e}),ue=e,f.success("初始资金已更新"),re()}catch(e){f.error("保存失败")}},ce=async()=>{try{await m.confirm("确定要清除所有历史数据吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await V.delete("/api/positions/history");e.data.success?(f.success("历史数据已清除"),Z.value=[],re()):f.error(e.data.error||"清除失败")}catch(e){"cancel"!==e&&f.error("清除失败: "+e.message)}};return a(()=>{(async()=>{try{const e=await V.get("/api/config");Q.value={...Q.value,...e.data},ue=Q.value.initial_capital}catch(e){f.error("加载配置失败")}})(),se(),ne(),(()=>{if(!ee.value)return;ae=U(ee.value);const e={tooltip:{trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"rgba(17, 17, 17, 0.95)",borderColor:"rgba(255, 255, 255, 0.1)",textStyle:{color:"#fff"},formatter:e=>{const a=e[0];if(!a)return"";const l=a.data,t="object"==typeof l?l.value:l;let i=`<div style="padding: 8px;">\n          <div style="margin-bottom: 8px; font-weight: 600;">${a.name}</div>\n          <div style="margin-bottom: 4px;">\n            <span style="color: #409eff;">账户余额:</span> \n            <span style="font-weight: 600;">${Number(t).toFixed(2)} USDT</span>\n          </div>`;return"object"==typeof l&&l.symbol&&(i+=`<div style="margin-bottom: 4px;">\n            <span style="color: rgba(255, 255, 255, 0.7);">交易对:</span> \n            <span>${l.symbol}</span>\n          </div>`),"object"==typeof l&&void 0!==l.pnl&&(i+=`<div>\n            <span style="color: rgba(255, 255, 255, 0.7);">本次盈亏:</span> \n            <span style="color: ${l.pnl>=0?"#10b981":"#ef4444"}; font-weight: 600;">\n              ${l.pnl>=0?"+":""}${Number(l.pnl).toFixed(2)} USDT\n            </span>\n          </div>`),i+="</div>",i}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{color:"rgba(255, 255, 255, 0.6)",rotate:30},axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.1)"}}},yAxis:{type:"value",axisLabel:{formatter:"{value} USDT",color:"rgba(255, 255, 255, 0.6)"},splitLine:{lineStyle:{color:"rgba(255, 255, 255, 0.05)"}},axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.1)"}}},series:[{name:"账户余额",type:"line",data:[],smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.05)"}]}},lineStyle:{color:"#409eff",width:2},itemStyle:{color:"#409eff"}}]};ae.setOption(e)})(),re();const e=setInterval(()=>{se(),ne(),re()},3e4);l(()=>{clearInterval(e),ae&&ae.dispose()})}),(e,a)=>{const l=t("el-icon"),m=t("el-button"),U=t("el-tag"),z=t("el-descriptions-item"),ae=t("el-descriptions"),de=t("el-card"),ue=t("el-divider"),_e=t("el-input"),ye=t("el-form-item"),fe=t("el-form"),me=t("el-dialog"),ve=t("el-col"),be=t("el-row"),he=t("el-badge"),ge=t("el-table-column"),we=t("el-table");return i(),o("div",A,[s(de,{class:"config-card",shadow:"hover"},{header:n(()=>[r("div",D,[r("span",null,[s(l,null,{default:n(()=>[s(d(v))]),_:1}),a[10]||(a[10]=u(" 基础配置",-1))]),s(m,{type:"primary",size:"small",onClick:a[0]||(a[0]=e=>Y.value=!0)},{default:n(()=>[s(l,null,{default:n(()=>[s(d(b))]),_:1}),a[11]||(a[11]=u(" 编辑配置 ",-1))]),_:1})])]),default:n(()=>[s(ae,{column:2,border:""},{default:n(()=>[s(z,{label:"币安API"},{default:n(()=>[Q.value.binance_api_key?(i(),o("span",I,p(le(Q.value.binance_api_key)),1)):(i(),c(U,{key:1,type:"warning"},{default:n(()=>[...a[12]||(a[12]=[u("未配置",-1)])]),_:1}))]),_:1}),s(z,{label:"AI模型"},{default:n(()=>[Q.value.ai_model?(i(),c(U,{key:0,type:"success"},{default:n(()=>[u(p(Q.value.ai_model),1)]),_:1})):(i(),c(U,{key:1,type:"info"},{default:n(()=>[...a[13]||(a[13]=[u("未配置",-1)])]),_:1}))]),_:1}),s(z,{label:"AI Base URL"},{default:n(()=>[u(p(Q.value.ai_base_url||"未配置"),1)]),_:1}),s(z,{label:"AI API Key"},{default:n(()=>[Q.value.ai_api_key?(i(),o("span",C,p(le(Q.value.ai_api_key)),1)):(i(),c(U,{key:1,type:"warning"},{default:n(()=>[...a[14]||(a[14]=[u("未配置",-1)])]),_:1}))]),_:1}),s(z,{label:"策略本金"},{default:n(()=>[Q.value.initial_capital?(i(),o("span",T,p(te(Q.value.initial_capital))+" USDT",1)):(i(),c(U,{key:1,type:"warning"},{default:n(()=>[...a[15]||(a[15]=[u("未设置",-1)])]),_:1}))]),_:1})]),_:1})]),_:1}),s(me,{modelValue:Y.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Y.value=e),title:"编辑基础配置",width:"700px"},{footer:n(()=>[s(m,{onClick:a[7]||(a[7]=e=>Y.value=!1)},{default:n(()=>[...a[20]||(a[20]=[u("取消",-1)])]),_:1}),s(m,{type:"primary",onClick:oe},{default:n(()=>[...a[21]||(a[21]=[u("保存配置",-1)])]),_:1})]),default:n(()=>[s(fe,{model:Q.value,"label-width":"120px"},{default:n(()=>[s(ue,{"content-position":"left"},{default:n(()=>[...a[16]||(a[16]=[u("币安配置",-1)])]),_:1}),s(ye,{label:"API Key"},{default:n(()=>[s(_e,{modelValue:Q.value.binance_api_key,"onUpdate:modelValue":a[1]||(a[1]=e=>Q.value.binance_api_key=e),placeholder:"请输入币安API Key","show-password":""},null,8,["modelValue"])]),_:1}),s(ye,{label:"API Secret"},{default:n(()=>[s(_e,{modelValue:Q.value.binance_api_secret,"onUpdate:modelValue":a[2]||(a[2]=e=>Q.value.binance_api_secret=e),type:"password",placeholder:"请输入币安API Secret","show-password":""},null,8,["modelValue"])]),_:1}),s(ue,{"content-position":"left"},{default:n(()=>[...a[17]||(a[17]=[u("AI配置",-1)])]),_:1}),s(ye,{label:"AI Model"},{default:n(()=>[s(_e,{modelValue:Q.value.ai_model,"onUpdate:modelValue":a[3]||(a[3]=e=>Q.value.ai_model=e),placeholder:"例如: gpt-4, gpt-3.5-turbo"},null,8,["modelValue"])]),_:1}),s(ye,{label:"Base URL"},{default:n(()=>[s(_e,{modelValue:Q.value.ai_base_url,"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value.ai_base_url=e),placeholder:"例如: https://api.openai.com"},null,8,["modelValue"])]),_:1}),s(ye,{label:"API Key"},{default:n(()=>[s(_e,{modelValue:Q.value.ai_api_key,"onUpdate:modelValue":a[5]||(a[5]=e=>Q.value.ai_api_key=e),type:"password",placeholder:"请输入AI API Key","show-password":""},null,8,["modelValue"])]),_:1}),s(ue,{"content-position":"left"},{default:n(()=>[...a[18]||(a[18]=[u("策略配置",-1)])]),_:1}),s(ye,{label:"策略本金"},{default:n(()=>[s(_e,{modelValue:Q.value.initial_capital,"onUpdate:modelValue":a[6]||(a[6]=e=>Q.value.initial_capital=e),modelModifiers:{number:!0},type:"number",placeholder:"请输入策略本金（USDT）"},{append:n(()=>[...a[19]||(a[19]=[u("USDT",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(de,{class:"account-card",shadow:"hover"},{header:n(()=>[r("div",$,[r("span",null,[s(l,null,{default:n(()=>[s(d(h))]),_:1}),a[22]||(a[22]=u(" 账户信息",-1))]),s(m,{size:"small",onClick:se,icon:d(g)},{default:n(()=>[...a[23]||(a[23]=[u("刷新",-1)])]),_:1},8,["icon"])])]),default:n(()=>[s(be,{gutter:20,class:"account-stats"},{default:n(()=>[s(ve,{span:8},{default:n(()=>[r("div",P,[a[25]||(a[25]=r("div",{class:"stat-label"},"总余额",-1)),r("div",L,[u(p(te(W.value.total_balance))+" ",1),a[24]||(a[24]=r("span",{class:"unit"},"USDT",-1))])])]),_:1}),s(ve,{span:8},{default:n(()=>[r("div",j,[a[27]||(a[27]=r("div",{class:"stat-label"},"可用余额",-1)),r("div",q,[u(p(te(W.value.available_balance))+" ",1),a[26]||(a[26]=r("span",{class:"unit"},"USDT",-1))])])]),_:1}),s(ve,{span:8},{default:n(()=>{return[r("div",K,[a[29]||(a[29]=r("div",{class:"stat-label"},"未实现盈亏",-1)),r("div",{class:_(["stat-value",(e=W.value.total_unrealized_pnl,e>0?"positive":e<0?"negative":"")])},[u(p(te(W.value.total_unrealized_pnl))+" ",1),a[28]||(a[28]=r("span",{class:"unit"},"USDT",-1))],2)])];var e}),_:1})]),_:1})]),_:1}),s(de,{class:"chart-card",shadow:"hover"},{header:n(()=>[r("div",B,[r("span",null,[s(l,null,{default:n(()=>[s(d(w))]),_:1}),a[30]||(a[30]=u(" 资金曲线（策略盈亏）",-1))]),r("div",M,[r("div",F,[a[31]||(a[31]=r("span",{class:"input-label"},"初始资金:",-1)),s(_e,{modelValue:Q.value.initial_capital,"onUpdate:modelValue":a[9]||(a[9]=e=>Q.value.initial_capital=e),modelModifiers:{number:!0},type:"number",size:"small",class:"capital-input",onBlur:pe,onKeyup:y(pe,["enter"]),placeholder:"1000"},null,8,["modelValue"]),a[32]||(a[32]=r("span",{class:"input-unit"},"USDT",-1))]),s(m,{size:"small",type:"danger",onClick:ce,icon:d(x)},{default:n(()=>[...a[33]||(a[33]=[u("重置",-1)])]),_:1},8,["icon"]),s(m,{size:"small",onClick:re,icon:d(g)},{default:n(()=>[...a[34]||(a[34]=[u("刷新",-1)])]),_:1},8,["icon"])])])]),default:n(()=>[r("div",{ref_key:"chartRef",ref:ee,style:{width:"100%",height:"350px"}},null,512)]),_:1}),s(de,{class:"positions-card",shadow:"hover"},{header:n(()=>[r("div",N,[r("span",O,[s(l,null,{default:n(()=>[s(d(k))]),_:1}),a[35]||(a[35]=r("span",null,"当前仓位",-1)),s(he,{value:X.value.length,class:"badge"},null,8,["value"])]),s(m,{size:"small",onClick:ne,icon:d(g)},{default:n(()=>[...a[36]||(a[36]=[u("刷新",-1)])]),_:1},8,["icon"])])]),default:n(()=>[r("div",R,[s(we,{data:X.value,stripe:"",style:{"min-width":"1200px"}},{default:n(()=>[s(ge,{prop:"symbol",label:"标的"},{default:n(({row:e})=>[s(U,{type:"primary"},{default:n(()=>[u(p(e.symbol),1)]),_:2},1024)]),_:1}),s(ge,{prop:"entry_time",label:"开仓时间"},{default:n(({row:e})=>[u(p(ie(e.entry_time)),1)]),_:1}),s(ge,{prop:"entry_price",label:"开仓价格"}),s(ge,{prop:"quantity",label:"数量"},{default:n(({row:e})=>[u(p(te(e.quantity)),1)]),_:1}),s(ge,{prop:"hold_bars",label:"当前K线"}),s(ge,{prop:"max_hold_bars",label:"最大K线"},{default:n(({row:e})=>[u(p(e.max_hold_bars||"-"),1)]),_:1}),s(ge,{prop:"unrealized_pnl",label:"利润"},{default:n(({row:e})=>[s(U,{type:(e.unrealized_pnl||0)>=0?"success":"danger",size:"small"},{default:n(()=>[u(p((e.unrealized_pnl||0)>=0?"+":"")+p(te(e.unrealized_pnl||0)),1)]),_:2},1032,["type"])]),_:1}),s(ge,{prop:"client_order_id",label:"自定义订单号",width:"300","show-overflow-tooltip":""},{default:n(({row:e})=>[e.client_order_id?(i(),c(U,{key:0,size:"small"},{default:n(()=>[u(p(e.client_order_id),1)]),_:2},1024)):(i(),o("span",E,p(e.order_id),1))]),_:1}),s(ge,{label:"操作"},{default:n(({row:e})=>[s(m,{type:"danger",size:"small",onClick:a=>(async e=>{try{const a=await V.post("/api/positions/close",{symbol:e.symbol});a.data.success?(f.success("平仓成功"),ne(),re()):f.error(a.data.error||"平仓失败")}catch(a){f.error("平仓失败: "+a.message)}})(e)},{default:n(()=>[...a[37]||(a[37]=[u("平仓",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),s(de,{class:"history-card",shadow:"hover"},{header:n(()=>[r("div",G,[r("span",null,[s(l,null,{default:n(()=>[s(d(S))]),_:1}),a[38]||(a[38]=u(" 历史仓位",-1))])])]),default:n(()=>[r("div",H,[s(we,{data:Z.value,stripe:"","max-height":"350",style:{"min-width":"1200px"}},{default:n(()=>[s(ge,{prop:"symbol",label:"标的"},{default:n(({row:e})=>[s(U,null,{default:n(()=>[u(p(e.symbol),1)]),_:2},1024)]),_:1}),s(ge,{prop:"entry_time",label:"开仓时间"},{default:n(({row:e})=>[u(p(ie(e.entry_time)),1)]),_:1}),s(ge,{prop:"exit_time",label:"平仓时间"},{default:n(({row:e})=>[u(p(ie(e.exit_time)),1)]),_:1}),s(ge,{prop:"entry_price",label:"开仓价格"},{default:n(({row:e})=>[u(p(te(e.entry_price)),1)]),_:1}),s(ge,{prop:"exit_price",label:"平仓价格"},{default:n(({row:e})=>[u(p(te(e.exit_price)),1)]),_:1}),s(ge,{prop:"quantity",label:"数量"},{default:n(({row:e})=>[u(p(te(e.quantity)),1)]),_:1}),s(ge,{prop:"pnl",label:"盈亏"},{default:n(({row:e})=>[s(U,{type:(e.pnl||0)>=0?"success":"danger"},{default:n(()=>[u(p((e.pnl||0)>=0?"+":"")+p(te(e.pnl||0)),1)]),_:2},1032,["type"])]),_:1}),s(ge,{prop:"client_order_id",label:"自定义订单号",width:"300","show-overflow-tooltip":""},{default:n(({row:e})=>[e.client_order_id?(i(),c(U,{key:0,size:"small"},{default:n(()=>[u(p(e.client_order_id),1)]),_:2},1024)):(i(),o("span",J,p(e.order_id),1))]),_:1})]),_:1},8,["data"])])]),_:1})])}}},[["__scopeId","data-v-1f12188a"]]);export{Y as default};
